create database dbexp8;
use dbexp8;
CREATE TABLE EMP (
    EMPNO INT,
    ENAME VARCHAR(20) NOT NULL,
    JOB VARCHAR(10) NOT NULL,
    DEPTNO INT,
    SAL DECIMAL(7,2),
    MGRNO INT
);

ALTER TABLE EMP
ADD CONSTRAINT EMP_EMPNO_CHECK CHECK (EMPNO > 100);

ALTER TABLE EMP
ADD CONSTRAINT EMP_DEPTNO_UNIQUE UNIQUE (DEPTNO);


ALTER TABLE EMP
ADD CONSTRAINT EMP_PK PRIMARY KEY (EMPNO);


CREATE TABLE DEPARTMENT (
    DEPTNO INT PRIMARY KEY,
    DNAME VARCHAR(20),
    LOCATION VARCHAR(20)
);


ALTER TABLE EMP
ADD CONSTRAINT EMP_DEPTNO_FK
FOREIGN KEY (DEPTNO) REFERENCES DEPARTMENT(DEPTNO);

CREATE TABLE MANAGER (
    MGRNO INT PRIMARY KEY,
    MGRNAME VARCHAR(20)
);


ALTER TABLE EMP
ADD CONSTRAINT EMP_MGRNO_FK
FOREIGN KEY (MGRNO) REFERENCES MANAGER(MGRNO);


CREATE TABLE SALARY_HISTORY (
    ID INT PRIMARY KEY,
    EMPNO INT,
    SALARY DECIMAL(7,2),
    EFFECTIVE_DATE DATE,
    CONSTRAINT SALARY_HISTORY_EMPNO_FK
    FOREIGN KEY (EMPNO) REFERENCES EMP(EMPNO)
);


ALTER TABLE SALARY_HISTORY
ADD CONSTRAINT SALARY_HISTORY_UNIQUE
UNIQUE (EMPNO, EFFECTIVE_DATE);


ALTER TABLE SALARY_HISTORY
ADD CONSTRAINT SALARY_HISTORY_SALARY_CHECK
CHECK (SALARY >= 0);


CREATE TABLE EMPLOYEE_BENEFITS (
    EMPNO INT,
    BENEFITS VARCHAR(50)
);

INSERT INTO DEPARTMENT (DEPTNO, DNAME, LOCATION) VALUES
(10, 'HR', 'Mumbai'),
(20, 'IT', 'Bangalore'),
(30, 'Finance', 'Delhi');


INSERT INTO MANAGER (MGRNO, MGRNAME) VALUES
(1001, 'Rajesh Kumar'),
(1002, 'Priya Sharma');


INSERT INTO EMP (EMPNO, ENAME, JOB, DEPTNO, SAL, MGRNO) VALUES
(101, 'Amit Patel', 'Manager', 10, 75000.00, 1001),
(102, 'Neha Gupta', 'Developer', 20, 60000.00, 1001),
(103, 'Suresh Singh', 'Analyst', 10, 65000.00, 1002),
(104, 'Anjali Reddy', 'Developer', 30, 62000.00, 1002),
(105, 'Vikram Mehta', 'Tester', 20, 58000.00, 1001);


INSERT INTO SALARY_HISTORY (ID, EMPNO, SALARY, EFFECTIVE_DATE) VALUES
(1, 101, 75000.00, '2023-01-01'),
(2, 101, 80000.00, '2023-06-01'),
(3, 102, 60000.00, '2023-01-01'),
(4, 103, 65000.00, '2023-01-01');


INSERT INTO EMPLOYEE_BENEFITS (EMPNO, BENEFITS) VALUES
(101, 'Health Insurance'),
(102, 'Dental Insurance'),
(104, 'Retirement Plan');


SELECT E.ENAME, D.DNAME, D.LOCATION
FROM EMP E
JOIN DEPARTMENT D ON E.DEPTNO = D.DEPTNO;


UPDATE EMP
SET SAL = SAL * 1.10
WHERE DEPTNO = 10;

DELETE FROM DEPARTMENT
WHERE DEPTNO = 30
AND NOT EXISTS (SELECT 1 FROM EMP WHERE DEPTNO = 30);


SELECT EMPNO, SALARY, EFFECTIVE_DATE
FROM SALARY_HISTORY
WHERE EMPNO = 101
ORDER BY EFFECTIVE_DATE DESC;


SELECT M.MGRNAME, E.ENAME
FROM MANAGER M
JOIN EMP E ON M.MGRNO = E.MGRNO;


SELECT E.ENAME
FROM EMP E
LEFT JOIN EMPLOYEE_BENEFITS EB ON E.EMPNO = EB.EMPNO
WHERE EB.BENEFITS IS NULL;


ALTER TABLE EMPLOYEE_BENEFITS
ADD CONSTRAINT EMPLOYEE_BENEFITS_EMPNO_FK
FOREIGN KEY (EMPNO) REFERENCES EMP(EMPNO);
